#!/usr/bin/env bash
# This script implements redirection to a index page


sudo cat > /etc/nginx/sites-available/default << EOF
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    location / {
        try_files \$uri \$uri/ =404;
    }
}
EOF

# Create the redirection block
sudo cat > /etc/nginx/sites-available/redirect_me << EOF
server {
    listen 80;
    listen [::]:80;

    server_name _;

    location / {
        return 200 "This is the output of the first task\n";
    }

    location /redirect_me {
        return 301 http://www.youtube.com/watch?v=QH2-TGUlwu4;
    }
}
EOF

# Step 3: Create document root directories
sudo mkdir -p /var/www/html

# Step 4: Create index.html for the first task output
sudo cat > /var/www/html/index.html << EOF
<html>
<head>
    <title>Hello World!</title>
</head>
<body>
    <h1>Hello World!</h1>
</body>
</html>
EOF
if [ -f /etc/nginx/sites-enabled/redirect_me ]; then
    echo "Removing existing configuration file..."
    sudo rm /etc/nginx/sites-enabled/redirect_me
fi


# Step 5: Create symbolic links and restart Nginx
sudo ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/
sudo ln -sf /etc/nginx/sites-available/redirect_me /etc/nginx/sites-enabled/
sudo systemctl restart nginx

echo "Nginx configured for redirection."
